<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Store</title>
  <style>
    /* Match restaurant.ejs dark theme */
    body { 
      background-color: #0c0f18; 
      color: white; 
    }

    .card { 
      background-color: #1c1f2e; 
      border-radius: 10px; 
      border: none;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .card-img-top {
      height: 160px; /* Match restaurant image height */
      width: 100%;
      object-fit: cover;
      object-position: center;
    }

    .card-body {
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 0 0 10px 10px;
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }

    .card-title {
      color: white;
      font-weight: bold;
      text-align: center;
    }

    .card-text {
      color: white;
      text-align: center;
      font-size: 1.25rem;
      font-weight: bold;
    }

    /* Stock info styling to match restaurant theme */
    .stock-info {
      font-size: 0.9rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .stock-high {
      color: #28a745;
      font-weight: 500;
    }
    
    .stock-medium {
      color: #ffc107;
      font-weight: 500;
    }
    
    .stock-low {
      color: #dc3545;
      font-weight: 500;
    }
    
    .out-of-stock {
      color: #6c757d;
      font-weight: 500;
    }

    /* Button styling to match restaurant */
    .btn-primary {
      background-color: #f49b00;
      border: none;
      font-weight: 500;
    }

    .btn-primary:hover {
      background-color: #e08900;
    }

    .btn-outline-secondary {
      border-color: #f49b00;
      color: #f49b00;
    }

    .btn-outline-secondary:hover {
      background-color: #f49b00;
      border-color: #f49b00;
      color: white;
    }

    .btn-secondary {
      background-color: #6c757d;
      border: none;
    }

    /* Quantity input styling */
    .quantity-input { 
      max-width: 80px;
      background-color: #2c3e50;
      color: white;
      border: 1px solid #f49b00;
    }

    .quantity-input:focus {
      background-color: #2c3e50;
      color: white;
      border-color: #f49b00;
      box-shadow: 0 0 0 0.2rem rgba(244, 155, 0, 0.25);
    }

    /* Title styling */
    .page-title {
      color: #f49b00;
      text-align: center;
      margin-bottom: 2rem;
    }

    /* Card spacing */
    .col-md-4 {
      margin-bottom: 2rem;
    }

    /* Button container */
    .button-container {
      margin-top: auto;
      text-align: center;
    }

    /* No items message */
    .no-items {
      text-align: center;
      margin-top: 3rem;
      color: #6c757d;
    }

    /* Toast styling - REMOVED */
  </style>
</head>
<body>



  <!-- SUCCESS MESSAGE POPUP (Same as restaurant.ejs) -->
  <% if (typeof message !== 'undefined' && message) { %>
    <div class="alert alert-success alert-dismissible fade show mb-4" role="alert" 
         style="background-color: #28a745 !important; border: none !important; color: white !important; border-radius: 8px !important; z-index: 9999 !important; position: relative !important; font-size: 1.1rem !important;">
      <i class="fas fa-shopping-cart me-2"></i> 
      <strong><%= message %></strong>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>

  <%- include('partials/Membernav', { member: member }) %>

  <div class="container mt-4">
    <h1 class="page-title">Our Store</h1>

    <div class="row">
      <% if (items && items.length > 0) { %>
        <% items.forEach(item => { %>
          <%
            // Get stock quantity - handle different possible column names
            const stock = item.itemquantity || item.ItemQuantity || item.stock || item.Stock || 0;
            const itemName = item.name || item.Name;
            const itemPrice = item.price || item.Price;
            const itemId = item.id || item.ItemID;
            const itemImage = item.image || item.storeitempic;
          %>
          
          <div class="col-md-4 mb-4">
            <div class="card text-white">
              <img src="/images/<%= itemImage %>" class="card-img-top" alt="<%= itemName %>" />
              <div class="card-body">
                <h5 class="card-title"><%= itemName %></h5>
                <p class="card-text">$<%= itemPrice.toFixed(2) %></p>

                <!-- Stock Display -->
                <div class="stock-info">
                  <% if (stock > 20) { %>
                    <span class="stock-high"> <%= stock %> in stock</span>
                  <% } else if (stock > 5) { %>
                    <span class="stock-medium"> <%= stock %> left</span>
                  <% } else if (stock > 0) { %>
                    <span class="stock-low"> Only <%= stock %> left!</span>
                  <% } else { %>
                    <span class="out-of-stock"> Out of stock</span>
                  <% } %>
                </div>

                <div class="button-container">
                  <% if (stock > 0) { %>
                    <!-- Form for adding to cart - styled like restaurant -->
                    <form action="/store/add-to-cart/<%= itemId %>" method="POST" class="mb-2">
                      <div class="d-flex align-items-center justify-content-center gap-2 mb-2">
                        <input type="number" 
                               name="quantity" 
                               class="form-control quantity-input text-center" 
                               value="1" 
                               min="1" 
                               max="<%= stock %>"
                               title="Available: <%= stock %>">
                        <button type="submit" class="btn btn-primary btn-sm px-3">
                          <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                      </div>
                    </form>
                  <% } else { %>
                    <!-- Disabled button when out of stock -->
                    <button type="button" class="btn btn-secondary mb-2" disabled>
                      <i class="fas fa-times"></i> Out of Stock
                    </button>
                  <% } %>

                  <a href="/product/<%= itemId %>" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-info-circle"></i> View More
                  </a>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-12">
          <div class="no-items">
            <h4>No items available in the store</h4>
            <p class="text-muted">Check back later for new products!</p>
          </div>
        </div>
      <% } %>
    </div>

    <!-- Cart Actions (Match restaurant style) -->
    <div class="text-center mt-4">
      <a href="/cart" class="btn btn-success btn-lg">
        <i class="fas fa-shopping-cart"></i> View Cart & Checkout
      </a>
    </div>
  </div>

  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
 
</body>
</html>