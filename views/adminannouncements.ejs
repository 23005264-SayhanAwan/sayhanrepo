<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Announcements</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
  body {
    background-color: #0c0f18;
    color: white;
    font-family: 'Segoe UI', sans-serif;
  }
  .card {
    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
    border: none;
    border-radius: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    color: #1f2937;
  }
  .card-title {
    font-size: 1.25rem;
    font-weight: bold;
    color: #1f2937;
  }
  .card-text {
    color: #374151;
  }
  .text-muted {
    color: #6b7280 !important;
  }
  .btn {
    border-radius: 0.5rem;
  }
  .modal-content {
    background-color: #1a1f2e;
    color: white;
  }
  
  /* Modal headers - light background for readability */
  .modal-header {
    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
    color: #1f2937;
    border-radius: 1rem 1rem 0 0;
    border-bottom: 1px solid #d1d5db;
  }
  
  .modal-title {
    color: #1f2937;
    font-weight: 600;
  }
  
  .btn-close {
    filter: none;
    background: none;
    border: none;
    font-size: 1.2rem;
    color: #6b7280;
    opacity: 0.7;
  }
  
  .btn-close:hover {
    opacity: 1;
    color: #374151;
  }
  
  /* Form controls in modals */
  .form-control, .form-select {
    background-color: #374151;
    border: 1px solid #4b5563;
    color: #f9fafb;
    border-radius: 0.5rem;
  }
  
  .form-control:focus, .form-select:focus {
    background-color: #374151;
    border-color: #6366f1;
    color: #f9fafb;
    box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
  }
  
  .form-control::placeholder {
    color: #9ca3af;
  }
  
  .form-label {
    color: #f9fafb;
    font-weight: 500;
  }
  
  /* Page title styling */
  .page-title {
    text-align: center;
    margin: 30px 0;
    font-weight: 700;
    color: #f49b00;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    font-size: 2.5rem;
  }

  .form-label {
    color: #000000;
    font-weight: 500;
  }
  
  /* Container styling */
  .announcements-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  /* Create announcement button */
  .create-btn-container {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .btn-create {
    background: linear-gradient(45deg, #f49b00, #d4850d);
    border: none;
    color: #000;
    font-weight: 600;
    padding: 12px 30px;
    border-radius: 10px;
    transition: all 0.3s ease;
  }
  
  .btn-create:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(244, 155, 0, 0.3);
    color: #000;
  }
  
  /* Card footer with better button styling */
  .card-footer {
    background: rgba(249, 250, 251, 0.8);
    border-top: 1px solid #e5e7eb;
  }
  
  /* Alert styling */
  .alert-info {
    background: rgba(59, 130, 246, 0.15);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: #93c5fd;
    border-radius: 0.75rem;
  }
  
  /* Badge improvements for better contrast */
  .badge.bg-warning {
    background-color: #f59e0b !important;
    color: #000 !important;
  }
  
  .badge.bg-danger {
    background-color: #ef4444 !important;
    color: #fff !important;
  }
  
  .badge.bg-secondary {
    background-color: #6b7280 !important;
    color: #fff !important;
  }
  
  .badge.bg-dark {
    background-color: #374151 !important;
    color: #fff !important;
  }
  
  /* Button improvements */
  .btn-warning {
    background-color: #f59e0b;
    border-color: #f59e0b;
    color: #000;
  }
  
  .btn-warning:hover {
    background-color: #d97706;
    border-color: #d97706;
    color: #000;
  }
  
  .btn-success {
    background-color: #10b981;
    border-color: #10b981;
  }
  
  .btn-info {
    background-color: #06b6d4;
    border-color: #06b6d4;
  }
  
  .btn-danger {
    background-color: #ef4444;
    border-color: #ef4444;
  }
  
  .btn-primary {
    background-color: #6366f1;
    border-color: #6366f1;
  }
  
  .btn-secondary {
    background-color: #6b7280;
    border-color: #6b7280;
    color: #fff;
  }
  
  /* Dropdown fix for consistency */
  .dropdown-menu {
    z-index: 9999 !important;
  }
</style>

</head>
<body>

  <!-- Include Admin Navbar -->
  <%- include('partials/Adminnav.ejs') %>

  <div class="announcements-container">
    <h2 class="page-title">
      <i class="fas fa-bullhorn me-3"></i>Manage Announcements
    </h2>

    <!-- Create New Announcement Button -->
    <div class="create-btn-container">
      <button class="btn btn-create" data-bs-toggle="modal" data-bs-target="#createModal">
        <i class="fas fa-plus me-2"></i>Create New Announcement
      </button>
    </div>

    <% if (announcements.length === 0) { %>
      <div class="alert alert-info text-center">
        <i class="fas fa-info-circle me-2"></i>No announcements yet. Create your first one!
      </div>
    <% } %>

    <% announcements.forEach(function(announcement) { %>
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">
            <%= announcement.Title %>
            <% if (announcement.Priority === 'High') { %>
              <span class="badge bg-danger">High</span>
            <% } else if (announcement.Priority === 'Medium') { %>
              <span class="badge bg-warning text-dark">Medium</span>
            <% } else { %>
              <span class="badge bg-secondary">Low</span>
            <% } %>
            <% if (announcement.Status === 'Inactive') { %>
              <span class="badge bg-dark">Inactive</span>
            <% } %>
          </h5>
          <p class="card-text"><%= announcement.Content %></p>
          <p class="card-text"><small class="text-muted">Created: <%= new Date(announcement.CreatedDate).toLocaleDateString() %></small></p>
          <% if (announcement.CreatedBy) { %>
            <p class="card-text"><small class="text-muted">By: <%= announcement.CreatedBy %></small></p>
          <% } %>
          <% if (announcement.ExpiryDate) { %>
            <p class="card-text"><small class="text-muted">Expires: <%= new Date(announcement.ExpiryDate).toLocaleDateString() %></small></p>
          <% } %>
        </div>
        <div class="card-footer">
          <div class="d-flex gap-2">
            <!-- Activate/Deactivate -->
            <form action="/Admin/announcements/toggle/<%= announcement.AnnouncementID %>" method="POST" class="flex-grow-1">
              <input type="hidden" name="status" value="<%= announcement.Status === 'Active' ? 'Inactive' : 'Active' %>">
              <button type="submit" class="btn btn-sm btn-<%= announcement.Status === 'Active' ? 'warning' : 'success' %> w-100">
                <i class="fas fa-<%= announcement.Status === 'Active' ? 'pause' : 'play' %> me-1"></i>
                <%= announcement.Status === 'Active' ? 'Deactivate' : 'Activate' %>
              </button>
            </form>

            <!-- Edit -->
            <button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#editModal-<%= announcement.AnnouncementID %>">
              <i class="fas fa-edit"></i>
            </button>

            <!-- Delete -->
            <form action="/Admin/announcements/delete/<%= announcement.AnnouncementID %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this announcement?')">
              <button type="submit" class="btn btn-sm btn-danger">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Edit Modal (one per announcement) -->
      <div class="modal fade" id="editModal-<%= announcement.AnnouncementID %>" tabindex="-1" aria-labelledby="editModalLabel-<%= announcement.AnnouncementID %>" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel-<%= announcement.AnnouncementID %>">
                <i class="fas fa-edit me-2"></i>Edit Announcement
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/Admin/announcements/edit/<%= announcement.AnnouncementID %>" method="POST">
              <div class="modal-body">
                <div class="mb-3">
                  <label for="title-<%= announcement.AnnouncementID %>" class="form-label">Title</label>
                  <input type="text" class="form-control" id="title-<%= announcement.AnnouncementID %>" name="title" required maxlength="255" value="<%= announcement.Title %>">
                </div>
                <div class="mb-3">
                  <label for="content-<%= announcement.AnnouncementID %>" class="form-label">Content</label>
                  <textarea class="form-control" id="content-<%= announcement.AnnouncementID %>" name="content" rows="5" required><%= announcement.Content %></textarea>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <label for="priority-<%= announcement.AnnouncementID %>" class="form-label">Priority</label>
                    <select class="form-select" id="priority-<%= announcement.AnnouncementID %>" name="priority" required>
                      <option value="Low" <%= announcement.Priority === 'Low' ? 'selected' : '' %>>Low</option>
                      <option value="Medium" <%= announcement.Priority === 'Medium' ? 'selected' : '' %>>Medium</option>
                      <option value="High" <%= announcement.Priority === 'High' ? 'selected' : '' %>>High</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="expiryDate-<%= announcement.AnnouncementID %>" class="form-label">Expiry Date</label>
                    <input type="date" class="form-control" id="expiryDate-<%= announcement.AnnouncementID %>" name="expiryDate"
                      value="<%= announcement.ExpiryDate ? new Date(announcement.ExpiryDate).toISOString().split('T')[0] : '' %>">
                  </div>
                </div>
              </div>
              <div class="modal-footer" style="border-top: 1px solid #374151;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save me-2"></i>Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    <% }); %>

    <!-- Create Modal -->
    <div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">
              <i class="fas fa-plus me-2"></i>Create New Announcement
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form action="/Admin/announcements/create" method="POST">
            <div class="modal-body">
              <div class="mb-3">
                <label for="createTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="createTitle" name="title" required maxlength="255" placeholder="Enter announcement title">
              </div>
              <div class="mb-3">
                <label for="createContent" class="form-label">Content</label>
                <textarea class="form-control" id="createContent" name="content" rows="5" required placeholder="Enter announcement content"></textarea>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label for="createPriority" class="form-label">Priority</label>
                  <select class="form-select" id="createPriority" name="priority" required>
                    <option value="Low">Low</option>
                    <option value="Medium" selected>Medium</option>
                    <option value="High">High</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="createExpiryDate" class="form-label">Expiry Date (Optional)</label>
                  <input type="date" class="form-control" id="createExpiryDate" name="expiryDate">
                </div>
              </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid #374151;">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Create Announcement
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>