<!DOCTYPE html>
<html>
<head>
  <title>Admin Management</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background-color: #0c0f18;
      color: white;
    }

    .admin-card {
      background-color: #1a1f2e;
      border: 1px solid #444;
      margin-bottom: 1rem;
    }

    .btn-warning {
      background-color: #f49b00;
      border-color: #f49b00;
    }

    .btn-warning:hover {
      background-color: #e88900;
      border-color: #e88900;
    }

    .form-label {
      color: white !important;
      font-weight: 500 !important;
      margin-bottom: 0.5rem !important;
      display: block !important;
    }

    /* Make all form fields true black with white text */
    .form-control,
    .form-select,
    textarea {
      background-color: #000000 !important;
      color: white !important;
      border-color: #444;
    }

    .form-control:focus,
    .form-select:focus,
    textarea:focus {
      background-color: #000000 !important;
      color: white !important;
      border-color: #f49b00;
      box-shadow: 0 0 0 0.25rem rgba(244, 155, 0, 0.25);
    }

    ::placeholder {
      color: #aaa !important;
      opacity: 1;
    }

    .modal-content {
      background-color: #1a1f2e;
      color: white;
    }

    .modal-header {
      border-bottom: 1px solid #444;
    }

    .modal-footer {
      border-top: 1px solid #444;
    }

    .modal-body .form-label {
      color: white !important;
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: block;
    }

    .profile-pic-small {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
    }

    .table-dark {
      background-color: #1a1f2e;
    }

    .table-dark td, .table-dark th {
      border-color: #444;
    }

    .btn-sm {
      margin: 2px;
    }
  </style>
</head>
<body>
  <%- include('partials/Adminnav') %>

  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Admin Management</h2>
      <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#addAdminModal">
        <i class="fas fa-plus"></i> Add New Admin
      </button>
    </div>

    <div class="card admin-card">
      <div class="card-header">
        <h5>Current Administrators</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-dark table-hover">
            <thead>
              <tr>
                <th>Profile</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% admins.forEach(function(adminUser) { %>
                <tr>
                  <td>
                    <img 
                      src="<%= adminUser.Admin_ProfilePicture ? '/images/' + adminUser.Admin_ProfilePicture : '/images/profilepc.jpeg' %>" 
                      alt="Profile" 
                      class="profile-pic-small"
                    />
                  </td>
                  <td><%= adminUser.Admin_FullName %></td>
                  <td><%= adminUser.Admin_Email %></td>
                  <td><%= adminUser.Admin_Phone %></td>
                  <td>
                    <span class="badge bg-warning text-dark"><%= adminUser.Role %></span>
                  </td>
                  <td>
                    <% if (adminUser.AdminID !== admin.AdminID) { %>
                      <button class="btn btn-info btn-sm" onclick="editAdmin(<%= adminUser.AdminID %>)">Edit</button>
                      <button class="btn btn-secondary btn-sm" onclick="changePassword(<%= adminUser.AdminID %>)">Change Password</button>
                      <button class="btn btn-danger btn-sm" onclick="deleteAdmin(<%= adminUser.AdminID %>, '<%= adminUser.Admin_FullName %>')">Delete</button>
                    <% } else { %>
                      <button class="btn btn-info btn-sm" onclick="editAdmin(<%= adminUser.AdminID %>)">Edit</button>
                      <button class="btn btn-secondary btn-sm" onclick="changePassword(<%= adminUser.AdminID %>)">Change Password</button>
                      <span class="text-warning ms-2">(Current User)</span>
                    <% } %>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Admin Modal -->
  <div class="modal fade" id="addAdminModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Admin</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <form action="/Admin/addadmins" method="POST">
          <div class="modal-body">
            <div class="mb-3">
              <label for="fullName" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="fullName" name="fullName" required />
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email" required />
            </div>
            <div class="mb-3">
              <label for="phone" class="form-label">Phone</label>
              <input type="text" class="form-control" id="phone" name="phone" required />
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input type="password" class="form-control" id="password" name="password" required minlength="6" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-warning">Create Admin</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Admin Modal -->
  <div class="modal fade" id="editAdminModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Admin</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <form id="editAdminForm" method="POST">
          <div class="modal-body">
            <input type="hidden" id="editAdminId" name="adminId" />
            <div class="mb-3">
              <label for="editFullName" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="editFullName" name="fullName" required />
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="editEmail" name="email" required />
            </div>
            <div class="mb-3">
              <label for="editPhone" class="form-label">Phone</label>
              <input type="text" class="form-control" id="editPhone" name="phone" required />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-warning">Update Admin</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Change Password</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <form id="changePasswordForm" method="POST">
          <div class="modal-body">
            <input type="hidden" id="passwordAdminId" name="adminId" />
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password</label>
              <input type="password" class="form-control" id="newPassword" name="newPassword" required minlength="6" />
            </div>
            <div class="mb-3">
              <label for="confirmPassword" class="form-label">Confirm New Password</label>
              <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required minlength="6" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-warning">Change Password</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Admin Modal -->
  <div class="modal fade" id="deleteAdminModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Delete</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete admin <strong id="deleteAdminName"></strong>?</p>
          <p class="text-danger">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <form id="deleteAdminForm" method="POST" style="display: inline;">
            <input type="hidden" id="deleteAdminId" name="adminId" />
            <button type="submit" class="btn btn-danger">Delete Admin</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    function editAdmin(adminId) {
      const row = document.querySelector(`tr:has(button[onclick*="editAdmin(${adminId})"])`);
      const cells = row.querySelectorAll('td');

      document.getElementById('editAdminId').value = adminId;
      document.getElementById('editFullName').value = cells[1].textContent;
      document.getElementById('editEmail').value = cells[2].textContent;
      document.getElementById('editPhone').value = cells[3].textContent;

      document.getElementById('editAdminForm').action = `/Admin/editadmin/${adminId}`;
      new bootstrap.Modal(document.getElementById('editAdminModal')).show();
    }

    function changePassword(adminId) {
      document.getElementById('passwordAdminId').value = adminId;
      document.getElementById('changePasswordForm').action = `/Admin/changepassword/${adminId}`;
      new bootstrap.Modal(document.getElementById('changePasswordModal')).show();
    }

    function deleteAdmin(adminId, adminName) {
      document.getElementById('deleteAdminId').value = adminId;
      document.getElementById('deleteAdminName').textContent = adminName;
      document.getElementById('deleteAdminForm').action = `/Admin/deleteadmin/${adminId}`;
      new bootstrap.Modal(document.getElementById('deleteAdminModal')).show();
    }

    document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
      const password = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match!');
      }
    });

    <% if (typeof message !== 'undefined') { %>
      setTimeout(() => {
        alert('<%= message %>');
      }, 100);
    <% } %>
  </script>
</body>
</html>
